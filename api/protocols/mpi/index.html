
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Mapper Proxy Main Page">
      
      
        <link rel="canonical" href="https://nstockton.github.io/mapperproxy-mume/api/protocols/mpi/">
      
      
        <meta name="author" content="Nick Stockton">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.0.2">
    
    
      
        <title>mpi.py - Mapper Proxy</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.38780c08.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.3f72e892.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mapper.protocols.mpi" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://nstockton.github.io/mapperproxy-mume" title="Mapper Proxy" class="md-header-nav__button md-logo" aria-label="Mapper Proxy">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Mapper Proxy
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              mpi.py
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/nstockton/mapperproxy-mume" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    nstockton/mapperproxy-mume
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://nstockton.github.io/mapperproxy-mume" title="Mapper Proxy" class="md-nav__button md-logo" aria-label="Mapper Proxy">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Mapper Proxy
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/nstockton/mapperproxy-mume" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    nstockton/mapperproxy-mume
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../" class="md-nav__link">
      API Index
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      API Navigation
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="API Navigation" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        API Navigation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1" checked>
    
    <label class="md-nav__link" for="nav-3-1">
      protocols
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="protocols" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        <span class="md-nav__icon md-icon"></span>
        protocols
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../base/" class="md-nav__link">
      base.py
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../manager/" class="md-nav__link">
      manager.py
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        mpi.py
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      mpi.py
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mapper.protocols.mpi" class="md-nav__link">
    mpi
  </a>
  
    <nav class="md-nav" aria-label="mpi">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol" class="md-nav__link">
    MPIProtocol
  </a>
  
    <nav class="md-nav" aria-label="MPIProtocol">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.state" class="md-nav__link">
    state
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.states" class="md-nav__link">
    states
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.edit" class="md-nav__link">
    edit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.on_command" class="md-nav__link">
    on_command()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.on_connectionLost" class="md-nav__link">
    on_connectionLost()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.on_connectionMade" class="md-nav__link">
    on_connectionMade()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.on_dataReceived" class="md-nav__link">
    on_dataReceived()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.on_unhandledCommand" class="md-nav__link">
    on_unhandledCommand()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.view" class="md-nav__link">
    view()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.write" class="md-nav__link">
    write()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../proxy/" class="md-nav__link">
      proxy.py
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../telnet/" class="md-nav__link">
      telnet.py
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../telnet_constants/" class="md-nav__link">
      telnet_constants.py
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xml/" class="md-nav__link">
      xml.py
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      roomdata
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="roomdata" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        <span class="md-nav__icon md-icon"></span>
        roomdata
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../roomdata/database/" class="md-nav__link">
      database.py
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../roomdata/objects/" class="md-nav__link">
      objects.py
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cleanmap/" class="md-nav__link">
      cleanmap.py
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../clock/" class="md-nav__link">
      clock.py
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../config/" class="md-nav__link">
      config.py
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../delays/" class="md-nav__link">
      delays.py
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../main/" class="md-nav__link">
      main.py
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mapper/" class="md-nav__link">
      mapper.py
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mudevents/" class="md-nav__link">
      mudevents.py
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../utils/" class="md-nav__link">
      utils.py
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../world/" class="md-nav__link">
      world.py
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../license/" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mapper.protocols.mpi" class="md-nav__link">
    mpi
  </a>
  
    <nav class="md-nav" aria-label="mpi">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol" class="md-nav__link">
    MPIProtocol
  </a>
  
    <nav class="md-nav" aria-label="MPIProtocol">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.state" class="md-nav__link">
    state
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.states" class="md-nav__link">
    states
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.edit" class="md-nav__link">
    edit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.on_command" class="md-nav__link">
    on_command()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.on_connectionLost" class="md-nav__link">
    on_connectionLost()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.on_connectionMade" class="md-nav__link">
    on_connectionMade()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.on_dataReceived" class="md-nav__link">
    on_dataReceived()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.on_unhandledCommand" class="md-nav__link">
    on_unhandledCommand()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.view" class="md-nav__link">
    view()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper.protocols.mpi.MPIProtocol.write" class="md-nav__link">
    write()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <div class="doc doc-object doc-module">
<h1 class="doc doc-heading" id="mapper.protocols.mpi">

        <span class="doc doc-types"><small class="doc doc-type doc-type-module"><code>Module</code></small></span>

        <code>mapper.protocols.mpi</code>


      <a class="headerlink" href="#mapper.protocols.mpi" title="Permanent link">&para;</a></h1>
<div class="doc doc-contents first">
<p>Mume Remote Editing Protocol.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="mapper.protocols.mpi.MPIProtocol">

        <span class="doc doc-types"><small class="doc doc-type doc-type-class"><code>Class</code></small></span>

        <code>MPIProtocol</code>


      <a class="headerlink" href="#mapper.protocols.mpi.MPIProtocol" title="Permanent link">&para;</a></h2>
<div class="doc doc-contents ">
<p>Implements support for the Mume remote editing protocol.</p>
<p><strong>Attributes:</strong></p>
<table class="data" role="grid">
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>commandMap</code></td>
<td><code>Mapping[bytes, Callable[]]</code></td>
<td>
<p>A mapping of bytes to callables.</p>
</td>
</tr>
<tr>
<td><code>editor</code></td>
<td><code>str</code></td>
<td>
<p>The program to use for editing received text.</p>
</td>
</tr>
<tr>
<td><code>pager</code></td>
<td><code>str</code></td>
<td>
<p>The program to use for viewing received read-only text.</p>
</td>
</tr>
</tbody>
</table>
<div class="doc doc-children">
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="mapper.protocols.mpi.MPIProtocol.state">

        <span class="doc doc-types"><small class="doc doc-type doc-type-attribute"><code>Attribute</code></small></span>

        <code class="highlight">state: <span class="nb">str</span>        </code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-writable"><code>writable</code></small>
  </span>

      <a class="headerlink" href="#mapper.protocols.mpi.MPIProtocol.state" title="Permanent link">&para;</a></h3>
<div class="doc doc-contents ">
<p>The state of the state machine.</p>
<p>Valid values are in <code>states</code>.</p>
</div>
</div>
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="mapper.protocols.mpi.MPIProtocol.states">

        <span class="doc doc-types"><small class="doc doc-type doc-type-attribute"><code>Attribute</code></small></span>

        <code class="highlight">states: <span class="n">AbstractSet</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>        </code>


      <a class="headerlink" href="#mapper.protocols.mpi.MPIProtocol.states" title="Permanent link">&para;</a></h3>
<div class="doc doc-contents ">
<p>Valid states for the state machine.</p>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="mapper.protocols.mpi.MPIProtocol.edit">

        <span class="doc doc-types"><small class="doc doc-type doc-type-method"><code>Method</code></small></span>

        <code class="highlight language-python">edit<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>        </code>


      <a class="headerlink" href="#mapper.protocols.mpi.MPIProtocol.edit" title="Permanent link">&para;</a></h3>
<div class="doc doc-contents ">
<p>Edits text using the program defined in <code>editor</code>.</p>
<p><strong>Parameters:</strong></p>
<table class="data" role="grid">
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data</code></td>
<td><code>bytes</code></td>
<td>
<p>Received data from Mume, containing the session, description, and body of the text.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>mapper\protocols\mpi.py</code></summary>
          <table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
	<span class="sd">"""</span>
<span class="sd">	Edits text using the program defined in `editor`.</span>

<span class="sd">	Args:</span>
<span class="sd">		data: Received data from Mume, containing the session, description, and body of the text.</span>
<span class="sd">	"""</span>
	<span class="n">session</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">LF</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
	<span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">"mume_editing_"</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">".txt"</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">fileObj</span><span class="p">:</span>
		<span class="n">fileName</span> <span class="o">=</span> <span class="n">fileObj</span><span class="o">.</span><span class="n">name</span>
		<span class="n">fileObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">CR</span><span class="p">,</span> <span class="sa">b</span><span class="s2">""</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">LF</span><span class="p">,</span> <span class="n">CR_LF</span><span class="p">))</span>
	<span class="n">lastModified</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputFormat</span> <span class="o">==</span> <span class="s2">"tintin"</span><span class="p">:</span>
		<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"MPICOMMAND:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">fileName</span><span class="si">}</span><span class="s2">:MPICOMMAND"</span><span class="p">)</span>
		<span class="nb">input</span><span class="p">(</span><span class="s2">"Continue:"</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">editorProcess</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">((</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">fileName</span><span class="p">))</span>
		<span class="n">editorProcess</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span> <span class="o">==</span> <span class="n">lastModified</span><span class="p">:</span>
		<span class="c1"># The user closed the text editor without saving. Cancel the editing session.</span>
		<span class="n">response</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">"C"</span> <span class="o">+</span> <span class="n">session</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s2">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fileObj</span><span class="p">:</span>
			<span class="n">response</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">"E"</span> <span class="o">+</span> <span class="n">session</span> <span class="o">+</span> <span class="n">LF</span> <span class="o">+</span> <span class="n">fileObj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
	<span class="n">response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">CR</span><span class="p">,</span> <span class="sa">b</span><span class="s2">""</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="n">LF</span>
	<span class="n">removeFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">MPI_INIT</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">"E"</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">"</span><span class="si">%d</span><span class="s2">"</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">+</span> <span class="n">LF</span> <span class="o">+</span> <span class="n">response</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="mapper.protocols.mpi.MPIProtocol.on_command">

        <span class="doc doc-types"><small class="doc doc-type doc-type-method"><code>Method</code></small></span>

        <code class="highlight language-python">on_command<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>        </code>


      <a class="headerlink" href="#mapper.protocols.mpi.MPIProtocol.on_command" title="Permanent link">&para;</a></h3>
<div class="doc doc-contents ">
<p>Called when an MPI command is received.</p>
<p><strong>Parameters:</strong></p>
<table class="data" role="grid">
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>command</code></td>
<td><code>bytes</code></td>
<td>
<p>The MPI command, consisting of a single byte.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>data</code></td>
<td><code>bytes</code></td>
<td>
<p>The payload.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>mapper\protocols\mpi.py</code></summary>
          <table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>188
189
190
191
192
193
194
195
196
197
198
199
200
201
202</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">on_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
	<span class="sd">"""</span>
<span class="sd">	Called when an MPI command is received.</span>

<span class="sd">	Args:</span>
<span class="sd">		command: The MPI command, consisting of a single byte.</span>
<span class="sd">		data: The payload.</span>
<span class="sd">	"""</span>
	<span class="k">if</span> <span class="n">command</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">commandMap</span><span class="p">:</span>
		<span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Invalid MPI command </span><span class="si">{</span><span class="n">command</span><span class="si">!r}</span><span class="s2">."</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">on_unhandledCommand</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
	<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">commandMap</span><span class="p">[</span><span class="n">command</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commandMap</span><span class="p">[</span><span class="n">command</span><span class="p">],</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="p">,),</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_MPIThreads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>
		<span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="mapper.protocols.mpi.MPIProtocol.on_connectionLost">

        <span class="doc doc-types"><small class="doc doc-type doc-type-method"><code>Method</code></small></span>

        <code class="highlight language-python">on_connectionLost<span class="p">(</span><span class="bp">self</span><span class="p">)</span>        </code>


      <a class="headerlink" href="#mapper.protocols.mpi.MPIProtocol.on_connectionLost" title="Permanent link">&para;</a></h3>
<div class="doc doc-contents ">
<p>Called by <code>disconnect</code> when a connection to peer has been lost.</p>
<details class="quote">
          <summary>Source code in <code>mapper\protocols\mpi.py</code></summary>
          <table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>208
209
210
211
212</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">on_connectionLost</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
	<span class="c1"># Clean up any active editing sessions.</span>
	<span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MPIThreads</span><span class="p">:</span>
		<span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_MPIThreads</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="mapper.protocols.mpi.MPIProtocol.on_connectionMade">

        <span class="doc doc-types"><small class="doc doc-type doc-type-method"><code>Method</code></small></span>

        <code class="highlight language-python">on_connectionMade<span class="p">(</span><span class="bp">self</span><span class="p">)</span>        </code>


      <a class="headerlink" href="#mapper.protocols.mpi.MPIProtocol.on_connectionMade" title="Permanent link">&para;</a></h3>
<div class="doc doc-contents ">
<p>Called by <code>connect</code> when a connection to peer has been established.</p>
<details class="quote">
          <summary>Source code in <code>mapper\protocols\mpi.py</code></summary>
          <table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>204
205
206</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">on_connectionMade</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
	<span class="c1"># Identify for Mume Remote Editing.</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">MPI_INIT</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">"I"</span> <span class="o">+</span> <span class="n">LF</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="mapper.protocols.mpi.MPIProtocol.on_dataReceived">

        <span class="doc doc-types"><small class="doc doc-type doc-type-method"><code>Method</code></small></span>

        <code class="highlight language-python">on_dataReceived<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>        </code>


      <a class="headerlink" href="#mapper.protocols.mpi.MPIProtocol.on_dataReceived" title="Permanent link">&para;</a></h3>
<div class="doc doc-contents ">
<p>Called by <code>parse</code> when data is received.</p>
<p><strong>Parameters:</strong></p>
<table class="data" role="grid">
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data</code></td>
<td><code>bytes</code></td>
<td>
<p>The received data.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>mapper\protocols\mpi.py</code></summary>
          <table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">on_dataReceived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># NOQA: C901</span>
	<span class="n">appDataBuffer</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">while</span> <span class="n">data</span><span class="p">:</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">"data"</span><span class="p">:</span>
			<span class="n">appData</span><span class="p">,</span> <span class="n">separator</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="n">LF</span><span class="p">)</span>
			<span class="n">appDataBuffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">appData</span> <span class="o">+</span> <span class="n">separator</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">separator</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">"newline"</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">"newline"</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">MPI_INIT</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">MPI_INIT</span><span class="p">)]):</span>
				<span class="c1"># Data starts with some or all of the MPI_INIT sequence.</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">"init"</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">"data"</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">"init"</span><span class="p">:</span>
			<span class="n">remaining</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">MPI_INIT</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="n">remaining</span><span class="p">])</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">remaining</span><span class="p">:]</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span> <span class="o">==</span> <span class="n">MPI_INIT</span><span class="p">:</span>
				<span class="c1"># The final byte in the MPI_INIT sequence has been reached.</span>
				<span class="k">if</span> <span class="n">appDataBuffer</span><span class="p">:</span>
					<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_dataReceived</span><span class="p">(</span><span class="sa">b</span><span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">appDataBuffer</span><span class="p">))</span>
					<span class="n">appDataBuffer</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">"command"</span>
			<span class="k">elif</span> <span class="ow">not</span> <span class="n">MPI_INIT</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span><span class="p">):</span>
				<span class="c1"># The Bytes in the buffer are not part of an MPI init sequence.</span>
				<span class="n">data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">"data"</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">"command"</span><span class="p">:</span>
			<span class="c1"># The MPI command is a single byte.</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">"length"</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">"length"</span><span class="p">:</span>
			<span class="n">length</span><span class="p">,</span> <span class="n">separator</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="n">LF</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
				<span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Invalid data </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span><span class="si">!r}</span><span class="s2"> in MPI length. Digit expected."</span><span class="p">)</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">MPI_INIT</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span><span class="p">)</span> <span class="o">+</span> <span class="n">separator</span> <span class="o">+</span> <span class="n">data</span>
				<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">"data"</span>
			<span class="k">elif</span> <span class="n">separator</span><span class="p">:</span>
				<span class="c1"># The buffer contains the length of subsequent bytes to be received.</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">"body"</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">"body"</span><span class="p">:</span>
			<span class="n">remaining</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="n">remaining</span><span class="p">])</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">remaining</span><span class="p">:]</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">:</span>
				<span class="c1"># The final byte in the expected MPI data has been received.</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">on_command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span><span class="p">))</span>
				<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span>
				<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_MPIBuffer</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">"data"</span>
	<span class="k">if</span> <span class="n">appDataBuffer</span><span class="p">:</span>
		<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_dataReceived</span><span class="p">(</span><span class="sa">b</span><span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">appDataBuffer</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="mapper.protocols.mpi.MPIProtocol.on_unhandledCommand">

        <span class="doc doc-types"><small class="doc doc-type doc-type-method"><code>Method</code></small></span>

        <code class="highlight language-python">on_unhandledCommand<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>        </code>


      <a class="headerlink" href="#mapper.protocols.mpi.MPIProtocol.on_unhandledCommand" title="Permanent link">&para;</a></h3>
<div class="doc doc-contents ">
<p>Called for commands for which no handler is installed.</p>
<p><strong>Parameters:</strong></p>
<table class="data" role="grid">
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>command</code></td>
<td><code>bytes</code></td>
<td>
<p>The MPI command, consisting of a single byte.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>data</code></td>
<td><code>bytes</code></td>
<td>
<p>The payload.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>mapper\protocols\mpi.py</code></summary>
          <table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>214
215
216
217
218
219
220
221
222</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">on_unhandledCommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
	<span class="sd">"""</span>
<span class="sd">	Called for commands for which no handler is installed.</span>

<span class="sd">	Args:</span>
<span class="sd">		command: The MPI command, consisting of a single byte.</span>
<span class="sd">		data: The payload.</span>
<span class="sd">	"""</span>
	<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_dataReceived</span><span class="p">(</span><span class="n">MPI_INIT</span> <span class="o">+</span> <span class="n">command</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">"</span><span class="si">%d</span><span class="s2">"</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="n">LF</span> <span class="o">+</span> <span class="n">data</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="mapper.protocols.mpi.MPIProtocol.view">

        <span class="doc doc-types"><small class="doc doc-type doc-type-method"><code>Method</code></small></span>

        <code class="highlight language-python">view<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>        </code>


      <a class="headerlink" href="#mapper.protocols.mpi.MPIProtocol.view" title="Permanent link">&para;</a></h3>
<div class="doc doc-contents ">
<p>Views text using the program defined in <code>pager</code>.</p>
<p><strong>Parameters:</strong></p>
<table class="data" role="grid">
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data</code></td>
<td><code>bytes</code></td>
<td>
<p>Received data from Mume, containing the text.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>mapper\protocols\mpi.py</code></summary>
          <table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
	<span class="sd">"""</span>
<span class="sd">	Views text using the program defined in `pager`.</span>

<span class="sd">	Args:</span>
<span class="sd">		data: Received data from Mume, containing the text.</span>
<span class="sd">	"""</span>
	<span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">"mume_viewing_"</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">".txt"</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">fileObj</span><span class="p">:</span>
		<span class="n">fileName</span> <span class="o">=</span> <span class="n">fileObj</span><span class="o">.</span><span class="n">name</span>
		<span class="n">fileObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">CR</span><span class="p">,</span> <span class="sa">b</span><span class="s2">""</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">LF</span><span class="p">,</span> <span class="n">CR_LF</span><span class="p">))</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputFormat</span> <span class="o">==</span> <span class="s2">"tintin"</span><span class="p">:</span>
		<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"MPICOMMAND:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pager</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">fileName</span><span class="si">}</span><span class="s2">:MPICOMMAND"</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">pagerProcess</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">((</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pager</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">fileName</span><span class="p">))</span>
		<span class="n">pagerProcess</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
		<span class="n">removeFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="mapper.protocols.mpi.MPIProtocol.write">

        <span class="doc doc-types"><small class="doc doc-type doc-type-method"><code>Method</code></small></span>

        <code class="highlight language-python">write<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>        </code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

      <a class="headerlink" href="#mapper.protocols.mpi.MPIProtocol.write" title="Permanent link">&para;</a></h3>
<div class="doc doc-contents ">
<p>Writes data to peer.</p>
<p><strong>Parameters:</strong></p>
<table class="data" role="grid">
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data</code></td>
<td><code>bytes</code></td>
<td>
<p>The bytes to be written.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>mapper\protocols\mpi.py</code></summary>
          <table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>53
54</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_writer</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright © 2020 Nick Stockton
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.77e55a48.min.js"></script>
      <script src="../../../assets/javascripts/bundle.9554a270.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../../../search/main.js"></script>
      
    
  </body>
</html>